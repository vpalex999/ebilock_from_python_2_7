<ns0:test-suite xmlns:ns0="urn:model.allure.qatools.yandex.ru" start="1495208391426" stop="1495208406519">
  <description>Test1 EHA client</description>
  <name>testserver.test_connect_eha_port1</name>
  <labels/>
  <test-cases>
    <test-case start="1495208391426" status="failed" stop="1495208406519">
      <description>Test connect client EHA to test server for port1</description>
      <name>test_1_eha_port1</name>
      <failure>
        <message>AssertionError: Detection Reconnect to local port 10000 from client EHA: [IPv4Address(TCP, '192.168.101.3', 41497), IPv4Address(TCP, '192.168.10.168', 65309)].
assert (1 &gt;= 2)</message>
        <stack-trace>reason = &lt;twisted.python.failure.Failure builtins.list: [IPv4Address(TCP, '192.168.101.3', 41497), IPv4Address(TCP, '192.168.10.168', 65309)]&gt;

    @allure.step("Call connected_err")
    def connected_err(reason):
        allure.attach("Return Error from test server",\
                      "Callback is return Error result connect for server\
                           {}:{} from: {}".format(data["server_host"],\
                                              data["server_port1"],\
                                              reason))
        assert reason.value, "Delay {} seconds connection to local port \{} from EHA"\
                             .format(data["timeout_connect"], data["server_port1"])
        count_connect = reason.value
        reconnect = 0
        other_ip = 0
        for client in count_connect:
            print("Search client", "Search client: {}".format(client))
            if data["double"]:
                if re.search(data["client_eha_side_1"], str(client)) or re.search(data["client_eha_side_2"], str(client)):
                    reconnect += 1
                else:
                    other_ip += 1
            else:
                if re.search(data["client_eha_float"], str(client)):
                    reconnect += 1
                else:
                    other_ip +=1
    
&gt;       assert reconnect &gt;= 2 and not other_ip, "Detection Reconnect to local port {} from client EHA: {}."\
            .format(data["server_port1"], count_connect)
E       AssertionError: Detection Reconnect to local port 10000 from client EHA: [IPv4Address(TCP, '192.168.101.3', 41497), IPv4Address(TCP, '192.168.10.168', 65309)].
E       assert (1 &gt;= 2)

test_connect_eha_port1.py:55: AssertionError</stack-trace>
      </failure>
      <attachments/>
      <labels>
        <label name="severity" value="normal"/>
        <label name="thread" value="24040-MainThread"/>
        <label name="host" value="Bubenshchikov"/>
      </labels>
      <steps>
        <step start="1495208391427" status="passed" stop="1495208391428">
          <name>Create_test_server() from tearUp/tearDown</name>
          <title>Create_test_server() from tearUp/tearDown</title>
          <attachments>
            <attachment source="da3552be-7d39-4d6f-bb82-742d1a0b0afc-attachment.txt" title="Create_test_server" type="text/plain"/>
            <attachment source="2a9328a5-ff67-4ea5-9b3e-19a8d0c9282d-attachment.txt" title="Defer from factory" type="text/plain"/>
          </attachments>
          <steps>
            <step start="1495208391427" status="passed" stop="1495208391428">
              <name>class ServerEHAFactory(Factory)</name>
              <title>class ServerEHAFactory(Factory)</title>
              <attachments/>
              <steps>
                <step start="1495208391427" status="passed" stop="1495208391428">
                  <name>Init factory</name>
                  <title>Init factory</title>
                  <attachments>
                    <attachment source="6c40885b-d7e9-4d99-b39a-4e7444f102c7-attachment.txt" title="Start reactor.callater" type="text/plain"/>
                  </attachments>
                  <steps/>
                </step>
              </steps>
            </step>
          </steps>
        </step>
        <step start="1495208391428" status="passed" stop="1495208391428">
          <name>Test_EHA_port1</name>
          <title>Test_EHA_port1</title>
          <attachments/>
          <steps>
            <step start="1495208391428" status="passed" stop="1495208391428">
              <name>Add: d.addCallbacks</name>
              <title>Add: d.addCallbacks</title>
              <attachments>
                <attachment source="bbfeb4f9-7f36-4e48-8da0-40f7e96cefca-attachment.txt" title="Add callbacks function connected() and connected_err()" type="text/plain"/>
              </attachments>
              <steps/>
            </step>
          </steps>
        </step>
        <step start="1495208406428" status="passed" stop="1495208406520">
          <name>Factory check_connect</name>
          <title>Factory check_connect</title>
          <attachments>
            <attachment source="a82b540b-0c81-4033-b8ce-4d4ef13d3522-attachment.txt" title="In check_connect" type="text/plain"/>
            <attachment source="79d7b745-db38-407e-8406-5d8323d278bc-attachment.txt" title="In count_connected" type="text/plain"/>
          </attachments>
          <steps>
            <step start="1495208406429" status="failed" stop="1495208406443">
              <name>Call connected_err</name>
              <title>Call connected_err</title>
              <attachments>
                <attachment source="8fbe61a3-289f-4d5e-bd19-15de09ecbff0-attachment.txt" title="Return Error from test server" type="text/plain"/>
              </attachments>
              <steps/>
            </step>
            <step start="1495208406520" status="passed" stop="1495208406520">
              <name>Stop test server</name>
              <title>Stop test server</title>
              <attachments>
                <attachment source="6f46c65f-0cbd-4c71-b7a8-db2bd01d805d-attachment.txt" title="Stop test server" type="text/plain"/>
              </attachments>
              <steps/>
            </step>
          </steps>
        </step>
      </steps>
    </test-case>
  </test-cases>
</ns0:test-suite>
